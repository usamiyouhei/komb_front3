<template>
  <FormBase
    class="FormAccessoryTermsCheck"
    :base="base"
    :label="label"
    :mode="mode"
    :width="width || base?.width"
    :col-width="colWidth"
    :hint="hint"
    :hintchip="hintchip"
  >
    <div>
      <div class="Textlink"><a @click="onOpen">利用規約</a><span>必ず確認してください</span></div>
      <ButtonToggle
        class="CheckButton mr-2"
        :style="{ marginLeft: '-8px', marginTop: '3.5px' }"
        icon="check"
        :value="input"
        :color="color"
        :actived="input"
        :disabled="!data?.isCheck"
        :label="'利用規約を確認した'"
        @update:value="onCheck($event)"
      />
    </div>
    <ClientOnly>
      <teleport to="#modal-area">
        <PartsModalWindow
          name="TermsCheckWindow"
          :title="'利用規約'"
          :switcher="switcher"
          :variableSize="variableRect"
          :fixedSize="fixedRect"
          :reset="true"
          :resize="true"
          :scroll="false"
          :fixed="false"
          :close="true"
          :modeless="false"
        >
          <div class="Dialog">
            <div class="DialogInner">
              <dl>
                <dt>1. 定義</dt>
                <dd>
                  本規約において使用される特定の用語は、本アプリケーションに関連する一定の文脈や条件でのみ適用されます。
                </dd>

                <dt>2. 適用範囲</dt>
                <dd>本規約は、すべてのユーザーが本アプリケーションにアクセスまたは使用する際に適用されます。</dd>

                <dt>3. ユーザー登録</dt>
                <dd>
                  ユーザーは正確かつ最新の情報を提供する義務があり、不正確な情報が判明した場合、アカウントが停止される可能性があります。
                </dd>

                <dt>4. アカウントのセキュリティ</dt>
                <dd>ユーザーは自身のアカウント情報の機密性を保ち、不正アクセスや不正使用から守る責任を負います。</dd>

                <dt>5. プライバシー</dt>
                <dd>当社は、ユーザーのプライバシーを尊重し、適用可能なデータ保護法を遵守します。</dd>

                <dt>6. 知的財産権</dt>
                <dd>
                  本アプリケーション内のコンテンツは知的財産権により保護されており、無断での複製や再配布は禁止されています。
                </dd>

                <dt>7. ユーザーの行動</dt>
                <dd>ユーザーは、違法、誤解を招く、脅迫的、または不適切な行動を禁止されています。</dd>

                <dt>8. コンテンツの使用</dt>
                <dd>提供されるコンテンツは参考のためであり、ユーザーのリスクにおいて使用されます。</dd>

                <dt>9. サービスの変更や停止</dt>
                <dd>当社は、事前の通知なくサービスを変更、中断、または終了する権利を保有します。</dd>

                <dt>10. 保証の否認</dt>
                <dd>本アプリケーションは、「現状有姿」で提供され、明示または黙示の保証は一切ありません。</dd>

                <dt>11. 制限された地域</dt>
                <dd>特定の地域からのアプリケーションの使用が法律により制限されている場合があります。</dd>

                <dt>12. 年齢制限</dt>
                <dd>ユーザーは、本アプリケーションを使用するために特定の年齢に達している必要があります。</dd>

                <dt>13. 第三者サービス</dt>
                <dd>
                  本アプリケーションは、第三者のサイトやサービスにリンクしている場合があり、それらのサイトの利用規約またはプライバシーポリシーは、本規約とは別個のものです。
                </dd>

                <dt>14. 免責事項</dt>
                <dd>
                  当社は、本アプリケーションに関連する直接的、間接的、偶発的、特別な損害について一切の責任を負いません。
                </dd>

                <dt>15. 規約の変更</dt>
                <dd>
                  当社は、必要に応じて、本規約を修正する権利を有します。変更は、本アプリケーション上で公開された時点で有効になります。
                </dd>

                <dt>16. 解約</dt>
                <dd>ユーザーは、いつでもアカウントを削除することにより、本サービスの使用を終了できます。</dd>

                <dt>17. 適用法および裁判管轄</dt>
                <dd>
                  本規約は、指定された法域の法律に従って解釈され、紛争に関しては指定の裁判所が専属的な管轄権を持ちます。
                </dd>

                <dt>18. 分離可能性</dt>
                <dd>
                  本規約のいずれかの条項が無効または執行不可能と判断された場合、その条項は削除され、残りの規約は完全に有効とします。
                </dd>

                <dt>19. 放棄</dt>
                <dd>本規約のいずれかの権利を行使しない、または執行しない場合でも、その放棄とはみなされません。</dd>

                <dt>20. 連絡先</dt>
                <dd>
                  本アプリケーションまたは規約に関するご質問やコメントがある場合は、指定された連絡先までお問い合わせください。
                </dd>
              </dl>
              <div class="ActionArea">
                <ButtonSimple text="閉じる" @click="switcher.opened = false" />
              </div>
            </div>
          </div>
        </PartsModalWindow>
      </teleport>
    </ClientOnly>
  </FormBase>
</template>

<script setup lang="ts">
/**===================================================================================================================
   * かなり特殊、
   ===================================================================================================================**/
import { type FixedSize, type VariableSize, type formProps } from '../../../components/common'
import { ref, watch, type Ref } from 'vue'
import type { ModalSwitch } from '../../../types'
//------------------------------------------------------------------------------------------------------------
// 引数
//------------------------------------------------------------------------------------------------------------
interface Props extends formProps {
  value?: any[]
  color?: string
  margin?: string
}
const props = withDefaults(defineProps<Props>(), {})

const isEdit = ref(props.edit || props.base?.edit)
const input = ref(false)
const switcher: Ref<ModalSwitch> = ref({ opened: false })

const variableRect: Ref<VariableSize> = ref({
  x: 500,
  y: 200,
  width: 600,
  minWidth: 600,
  maxWidth: 600,
  height: 600,
  minHeight: 400,
  maxHeight: 800,
  justify: 'center',
})

// サイズ固定＆不動ダイアログ
const fixedRect: Ref<FixedSize> = ref({
  justify: 'center',
  align: 'center',
  offsetX: '-10px',
  offsetY: '200px',
  width: '500px',
  height: '600px',
})

//------------------------------------------------------------------------------------------------------------
//watch
//------------------------------------------------------------------------------------------------------------
watch(
  () => props.data,
  (value) => {
    if (props.data) {
      // valuesからのchecked設定
      // console.log('？', props.data.onCheck)
      if (props.data.value && props.data.value === 'true') {
        input.value = true
      } else if (props.data.value && props.data.value !== 'false') {
        input.value = true
      } else {
        input.value = false
      }
      if (props.data) {
        if (value?.onCheck === 'check') {
          validation()
          props.data.onCheck = ''
        } else if (value?.onCheck === 'clear') {
          props.data.onCheck = ''
          props.data.error = ''
          props.data.isCheck = false
        }
      }
      if (value?.error) {
        // inputError.value = value?.error
      }
    }
  },
  {
    deep: true,
  }
)

const emits = defineEmits<{
  (e: 'update:value', value: string): void
  (e: 'update:error', value: string): void
}>()

function onCheck(value: any) {
  input.value = !value
  if (props.data) {
    props.data.value = String(input.value)
  }
  validation()
  emits('update:value', value)
  // emits('update:error', inputError.value || '')
}

function onOpen() {
  if (props.data) props.data.isCheck = true
  switcher.value.opened = true
}

function validation() {
  if (props.data) props.data.isCheck = true
  if (input.value === true) {
    if (props.data) props.data.error = ''
  } else {
    if (props.data) props.data.error = '必須項目です'
  }
}
</script>

<style scoped>
.FormAccessoryTermsCheck {
  position: relative;
}
.FormAccessoryTermsCheck .Textlink {
  margin: 20px 0 10px;
  font-size: 14px;
}
.FormAccessoryTermsCheck .Textlink a {
  color: rgba(var(--r-color-link));
  text-decoration-line: underline;
}
.FormAccessoryTermsCheck .Textlink span {
  margin-left: 10px;
  font-size: 12px;
  color: rgba(var(--r-color-error));
}

.Dialog {
  position: relative;
  height: 100%;
  width: 100%;
}
.Dialog .DialogInner {
  position: relative;
  width: 100%;
  height: 100%;
  overflow-y: scroll;
  padding: 10px 20px;
}
.Dialog .DialogInner dt {
  font-size: 12px;
  font-weight: 600;
  margin: 0px;
  color: #666;
}
.Dialog .DialogInner dd {
  font-size: 12px;
  margin: 8px 0px 20px;
  color: #666;
}
.Dialog .ActionArea {
  position: relative;
  height: 30px;
  margin-top: 30px;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}
</style>
