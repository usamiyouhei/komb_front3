<template>
  <ClientOnly>
    <teleport to="#modal-area">
      <PartsModalWindow
        name="ListHeaderChoice"
        :level="0"
        :title="'列表示カスタマイズ'"
        :switcher="switcher"
        :modeless="true"
        :fixed="true"
        :resize="true"
        :variableSize="variableRect"
        :fixedSize="fixedRect"
        :reset="isReset"
        :small="true"
      >
        <div class="ChoiceItems">
          <template v-for="item in headers">
            <ButtonToggle
              v-if="item.choice && !item.disabled"
              class="mr-2 mb-0"
              :value="item.key"
              :label="item.title"
              :icon="TOGGLE_TYPE.CHECK"
              :actived="input[item.key]"
              @update:value="onChange(item.key)"
            />
          </template>
        </div>
      </PartsModalWindow>
    </teleport>
  </ClientOnly>
</template>

<script setup lang="ts">
/**===================================================================================================================
   *
   ===================================================================================================================**/
import {
  type DataTableHeader,
  FORM_MODE,
  FORM_ITEM,
  type formItem,
  type baseProps,
  type ToggleProps,
  TOGGLE_TYPE,
  type VariableSize,
  type FixedSize,
} from '../../components/common'
import { ref, watch, onBeforeMount, type Ref, onMounted } from 'vue'
import { useListColumnSetting } from '../../composables/list'
import type { ModalSwitch } from '../../types'
//------------------------------------------------------------------------------------------------------------
// 引数
//------------------------------------------------------------------------------------------------------------
interface Props {
  name: string
  switcher: ModalSwitch
  headers: DataTableHeader[]
  fixedRect?: any
}
const props = withDefaults(defineProps<Props>(), {
  fixedRect: {
    justify: 'flex-end',
    align: 'flex-start',
    offsetX: '-10px',
    offsetY: '200px',
    width: '200px',
    height: '200px',
  },
})
//------------------------------------------------------------------------------------------------------------
// 定数・変数（state）
//------------------------------------------------------------------------------------------------------------
const isReset = ref(false)
// サイズ変更＆可動ダイアログ

const input: Ref<{ [key: string]: boolean }> = ref({})

const variableRect: Ref<VariableSize> = ref({
  y: 200,
  width: 200,
  minWidth: 200,
  maxWidth: 200,
  height: 200,
  minHeight: 100,
  maxHeight: 400,
})

const columnSetting = useListColumnSetting()

//------------------------------------------------------------------------------------------------------------
// ライフサイクル
//------------------------------------------------------------------------------------------------------------
onMounted(() => {
  //データが保存されていない場合、最初は全部true
  const saveData = columnSetting.value[props.name]
  if (saveData) {
    input.value = saveData.columns
  } else {
    for (const key in props.headers) {
      input.value[props.headers[key].key] = true
    }
    columnSetting.value[props.name] = { name: props.name, columns: input.value }
  }
})

function check(value: DataTableHeader[]) {}

//------------------------------------------------------------------------------------------------------------
//watch
//------------------------------------------------------------------------------------------------------------

//------------------------------------------------------------------------------------------------------------
//computed
//------------------------------------------------------------------------------------------------------------
/*
  const counter: Ref<number> = useState('counter', () => 500)

  // computedによりcounter変数の監視が行われる
  const doubleCount = computed(() => {
    return counter.value * 2
  })
  */
//------------------------------------------------------------------------------------------------------------
// エミット
//------------------------------------------------------------------------------------------------------------

//------------------------------------------------------------------------------------------------------------
// メソッド
//------------------------------------------------------------------------------------------------------------
function onChange(key: string) {
  input.value[key] = !input.value[key]
  columnSetting.value[props.name].columns = input.value
}

function onClose() {}
</script>

<style scoped>
.ChoiceItems {
  position: relative;
}
</style>
