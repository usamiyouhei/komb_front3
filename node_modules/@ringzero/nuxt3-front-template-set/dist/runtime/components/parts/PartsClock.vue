<template>
  <div class="Content">
    <div v-if="selectType === CLOCK_TYPE.DISPLAY">現在の時刻：{{ nowTime }}</div>
    <div v-if="selectType === CLOCK_TYPE.INPUT_DIAL">
      <div>現在の時刻：{{ hour }}:{{ minute }}:{{ second }}</div>
      <div class="d-flex">
        <FormInput class="mr-3" :width="200" :edit="true" placeholder="時間を選択" @click="onOpen(true)" />
        <ButtonSimple
          class="mt-1-5"
          :backcolor="useColor(THEME_COLOR.error)"
          text="リセット"
          small
          @click="resetDate"
        />
      </div>
      <PartsDialogWindow
        :switcher="modalSwitch"
        :buttons="DIALOG_BUTTON.OK_CANCEL"
        :colors="useSetColors(DIALOG_COLOR.TWO)"
        :fixedSize="fixedRect"
        :reset="true"
        :title="'時間選択'"
        @update:value="onSubmit($event)"
        @update:close="modalSwitch.opened = false"
      >
        <section class="DialClock">
          <!-- <div class="PickTime">
                  <div :class="{ Time: selectFrame === 0 }">{{ currentHour }}</div>
                  <span>:</span>
                  <div :class="{ Time: selectFrame === 1 }">{{ currentMinute }}</div>
                  <span>:</span>
                  <div :class="{ Time: selectFrame === 2 }">{{ currentSecond }}</div>
                </div> -->
          <div class="Container">
            <button v-if="selectFrame !== 0" class="Button mr-2" @click="changeFrame('down')">&lt;</button>
            <button v-if="selectFrame === 0" class="HiddenButton mr-2"></button>
            <div class="Dials">
              <div class="AnalogClock">
                <div class="AnalogFrame" ref="clockRef" @wheel="moveWheel"></div>
                <div
                  class="AnalogHand"
                  ref="clockHand"
                  :style="[changeDegree(selectFrame), selectHourWidth()]"
                  @mousedown="onMouseDown"
                ></div>
                <div class="AnalogHand AnalogCenter"></div>
                <div v-if="selectFrame === 0">
                  <template v-for="(t, index) in [...hour12, ...hour24]" :key="index">
                    <div @mousedown="onMouseDown" @wheel="moveWheel">
                      <span
                        class="AnalogNum"
                        :class="[
                          onColor(selectFrame, t.value),
                          { grayFont: (selectHour >= 12 && t.value < 12) || (selectHour <= 11 && t.value > 11) },
                        ]"
                        :style="{ '--backColor': useColor(primaryColor) }"
                        @click="moveClock(t.value)"
                      >
                        {{ t.value }}
                      </span>
                    </div>
                  </template>
                </div>
                <div v-if="selectFrame === 1 || selectFrame === 2">
                  <div @mousedown="onMouseDown">
                    <template v-for="(t, index) in time60" :key="index">
                      <span
                        class="TimeNum"
                        :class="onColor(selectFrame, t.value)"
                        :style="{ '--backColor': useColor(primaryColor) }"
                        @click="moveClock(t.value)"
                      >
                        {{ t.value }}
                      </span>
                    </template>
                    <div
                      v-for="i in nonFiveMultipleNumbers"
                      :key="i"
                      class="PointContainer"
                      :class="changeBackGround(i)"
                      :style="{
                        transform: `rotate(${6 * i}deg) translateY(-106px)`,
                        '--backColor': useColor(primaryColor),
                      }"
                      @click="moveClock(i)"
                    >
                      <p class="Point">・</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <button v-if="selectFrame !== 2" class="Button ml-2" @click="changeFrame('up')">></button>
            <button v-if="selectFrame === 2" class="HiddenButton ml-2"></button>
          </div>
        </section>
      </PartsDialogWindow>
    </div>
    <div v-if="selectType === CLOCK_TYPE.DIAL">
      <section class="DialClock">
        <!-- <div class="Header">
            <div class="PickTime">
              <div :class="{ Time: selectFrame === 0 }">{{ currentHour }}</div>
              <span>:</span>
              <div :class="{ Time: selectFrame === 1 }">{{ currentMinute }}</div>
              <span>:</span>
              <div :class="{ Time: selectFrame === 2 }">{{ currentSecond }}</div>
            </div>
            <ButtonSimple
              class="ml-4"
              :backcolor="useColor(THEME_COLOR.error)"
              text="リセット"
              small
              @click="resetDate"
            />
          </div> -->
        <div class="Container">
          <div class="Buttons" v-if="action">
            <button v-if="selectFrame !== 0" class="Button mr-2" @click.stop="changeFrame('down')">&lt;</button>
            <button v-if="selectFrame === 0" class="HiddenButton mr-2"></button>
          </div>
          <div class="Dials">
            <div class="AnalogClock">
              <div class="AnalogFrame" ref="clockRef" @wheel="moveWheel"></div>
              <div
                class="AnalogHand"
                ref="clockHand"
                :style="[changeDegree(selectFrame), selectHourWidth()]"
                @mousedown="onMouseDown"
              ></div>
              <div class="AnalogHand AnalogCenter"></div>
              <div v-if="selectFrame === 0">
                <template v-for="(t, index) in [...hour12, ...hour24]" :key="index">
                  <div @mousedown="onMouseDown" @wheel="moveWheel">
                    <span
                      class="AnalogNum"
                      :class="[
                        onColor(selectFrame, t.value),
                        { grayFont: (selectHour >= 12 && t.value < 12) || (selectHour <= 11 && t.value > 11) },
                      ]"
                      :style="{ '--backColor': useColor(primaryColor) }"
                      @click="moveClock(t.value)"
                    >
                      {{ t.value }}
                    </span>
                  </div>
                </template>
              </div>
              <div v-if="selectFrame === 1 || selectFrame === 2">
                <div @mousedown="onMouseDown" @wheel="moveWheel">
                  <template v-for="(t, index) in time60" :key="index">
                    <span
                      class="TimeNum"
                      :class="onColor(selectFrame, t.value)"
                      :style="{ '--backColor': useColor(primaryColor) }"
                      @click="moveClock(t.value)"
                    >
                      {{ t.value }}
                    </span>
                  </template>
                  <div
                    v-for="i in nonFiveMultipleNumbers"
                    :key="i"
                    class="PointContainer"
                    :class="changeBackGround(i)"
                    :style="{
                      transform: `rotate(${6 * i}deg) translateY(-106px)`,
                      '--backColor': useColor(primaryColor),
                    }"
                    @click="moveClock(i)"
                  >
                    <p class="Point">・</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="Buttons" v-if="action">
            <button v-if="selectFrame !== 2" class="Button ml-2" @click.stop="changeFrame('up')">></button>
            <button v-if="selectFrame === 2" class="HiddenButton ml-2"></button>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script setup lang="ts">
/**===================================================================================================================
   ===================================================================================================================**/
import dayjs from 'dayjs'
import { type baseProps, FORM_MODE, CLOCK_TYPE, type FixedSize } from '../../components/common'
import { ref, watch, type Ref, computed, onBeforeUnmount } from 'vue'
import { THEME_COLOR } from '../../composables/constants'
import { useColor } from '../../composables/colors'
import { DIALOG_BUTTON, useSetColors, DIALOG_COLOR } from '../../composables/useDialog'
import type { ModalSwitch } from '../../types'

//------------------------------------------------------------------------------------------------------------
// 引数
//------------------------------------------------------------------------------------------------------------
interface Props {
  selectType: string
  fixedRect?: FixedSize
  hour?: string
  minute?: string
  second?: string
  activeFrame?: number
  action?: boolean
  reset?: boolean
}
const props = withDefaults(defineProps<Props>(), {
  hour: dayjs().hour().toString(),
  minute: dayjs().minute().toString(),
  second: dayjs().second().toString(),
  activeFrame: 0,
  action: true,
  reset: false,
})

//------------------------------------------------------------------------------------------------------------
// 定数・変数（state）
//------------------------------------------------------------------------------------------------------------
const hour12 = [
  { text: '01', value: 1 },
  { text: '02', value: 2 },
  { text: '03', value: 3 },
  { text: '04', value: 4 },
  { text: '05', value: 5 },
  { text: '06', value: 6 },
  { text: '07', value: 7 },
  { text: '08', value: 8 },
  { text: '09', value: 9 },
  { text: '10', value: 10 },
  { text: '11', value: 11 },
  { text: '00', value: 0 },
]

const hour24 = [
  { text: '13', value: 13 },
  { text: '14', value: 14 },
  { text: '15', value: 15 },
  { text: '16', value: 16 },
  { text: '17', value: 17 },
  { text: '18', value: 18 },
  { text: '19', value: 19 },
  { text: '20', value: 20 },
  { text: '21', value: 21 },
  { text: '22', value: 22 },
  { text: '23', value: 23 },
  { text: '12', value: 12 },
]

const time60 = [
  { text: '05', value: 5 },
  { text: '10', value: 10 },
  { text: '15', value: 15 },
  { text: '20', value: 20 },
  { text: '25', value: 25 },
  { text: '30', value: 30 },
  { text: '35', value: 35 },
  { text: '40', value: 40 },
  { text: '45', value: 45 },
  { text: '50', value: 50 },
  { text: '55', value: 55 },
  { text: '00', value: 0 },
]
// 現在の時間
const nowTime = ref(dayjs().format('hh:mm:ss'))
// モーダルの開閉
const modalSwitch: Ref<ModalSwitch> = ref({ opened: false })
// インプットのカスタム
const custom: Ref<baseProps> = ref({ label: {} })
// セットされた時間
const hour = ref(formatTime(props.hour))
const minute = ref(formatTime(props.minute))
const second = ref(formatTime(props.second))
// ダイアログ内でセットしている時間
const currentHour = ref(formatTime(props.hour))
const currentMinute = ref(formatTime(props.minute))
const currentSecond = ref(formatTime(props.second))
// ダイアル時計の針
const clockHand = ref<HTMLDivElement | null>(null)
const clockRef = ref<HTMLDivElement | null>(null)
// 選択しているフレームの位置
const selectFrame = ref(props.activeFrame)
// 選択している時間
const selectHour = ref(formattedTime(props.hour))
const selectMinute = ref(formattedTime(props.minute))
const selectSecond = ref(formattedTime(props.second))
// 選択時のカラー
const primaryColor = THEME_COLOR.primary
// ダイアル時計の位置
const clockRect = ref()
// ダイアル時計の中央値
const centerX = ref()
const centerY = ref()
// マウスの位置
const mouseX = ref()
const mouseY = ref()
// マウスの位置と中心の位置からの差分
const dx = ref()
const dy = ref()
// 方向（値：π）
const radians = ref()
// 角度
const hourDegrees = ref(setDegree('hour'))
const minuteDegrees = ref(setDegree('minute'))
const secondDegrees = ref(setDegree('second'))
// リセット
const resetStatus = ref(props.reset)
// モーダルの大きさ
const fixedRect = ref({
  justify: props.fixedRect?.justify || 'center',
  align: props.fixedRect?.align || 'center',
  offsetX: props.fixedRect?.offsetX || '0px',
  offsetY: props.fixedRect?.offsetY || '0px',
  width: props.fixedRect?.width || '350px',
  height: props.fixedRect?.height || '280px',
})
// FormInputのカスタム
custom.value = {
  label: {
    width: 0,
    weight: 'normal',
    align: 'flex-start',
  },
  edit: false,
  mode: FORM_MODE.INLINE,
}
//------------------------------------------------------------------------------------------------------------
// emits
//------------------------------------------------------------------------------------------------------------
const emits = defineEmits<{
  (e: 'update:value', frameNum: number): void
  (e: 'update:time', hour: number, minute: number, second: number): void
  (e: 'update:inputState', value: boolean): void
  (e: 'update:reset', value: boolean): void
}>()
//------------------------------------------------------------------------------------------------------------
// computed
//------------------------------------------------------------------------------------------------------------
const nonFiveMultipleNumbers = computed(() => {
  return Array.from({ length: 60 }, (_, i) => i + 1).filter((num) => num % 5 !== 0)
})

// 時の変更を監視
const formattedHour = computed(() => {
  currentHour.value = normalizeTimeValue(currentHour.value, 24, 0)
  return formatTime(currentHour.value)
})

// 分の変更を監視
const formattedMinute = computed(() => {
  currentMinute.value = normalizeTimeValue(currentMinute.value, 59, 0)
  return formatTime(currentMinute.value)
})

// 秒の変更を監視
const formattedSecound = computed(() => {
  currentSecond.value = normalizeTimeValue(currentSecond.value, 59, 0)
  return formatTime(currentSecond.value)
}) //------------------------------------------------------------------------------------------------------------
// watch
//------------------------------------------------------------------------------------------------------------
watch([currentHour, currentMinute, currentSecond], ([newHour, newMinute, newSecond]) => {
  // TODO: 数字が一桁の場合、先頭に0を付けてエミットしていたが、生の数値を送るように修正する必要がある。
  // 数値の加工は受け取った側でしたほうが効率が良い。
  // 一旦、渡す直前に加工する

  emits('update:time', Number(newHour), Number(newMinute), Number(newSecond))
})

watch(
  () => selectFrame.value,
  (value) => {
    emits('update:value', value)
  }
)

watch(
  () => props.activeFrame,
  (value) => {
    selectFrame.value = value
  }
)

watch(
  () => props.activeFrame,
  (value) => {
    selectFrame.value = value
  }
)

watch(
  () => props.reset,
  (value) => {
    // console.log(value)
    resetStatus.value = value
    resetDate()
    emits('update:reset', false)
  }
)

watch(
  () => [props.hour, props.minute, props.second],
  ([hourValue, minuteValue, secondValue]) => {
    hour.value = hourValue
    currentHour.value = hourValue
    selectHour.value = formattedTime(hourValue)

    minute.value = minuteValue
    currentMinute.value = minuteValue
    selectMinute.value = formattedTime(minuteValue)

    second.value = secondValue
    currentSecond.value = secondValue
    selectSecond.value = formattedTime(secondValue)

    if (!clockHand.value) return
    if (selectFrame.value === 0) {
      let degree = 0
      let selectTime = selectHour.value
      if (selectTime > 23) selectTime = 0
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      if (Number.isNaN(selectTime)) {
        degree
      } else {
        degree = (360 / 12) * selectTime
      }
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentHour.value = resultingValue
      selectHour.value = selectTime
      hourDegrees.value = degree
    } else if (selectFrame.value === 1) {
      let degree = 0
      let selectTime = selectMinute.value
      if (selectTime > 59) selectTime = 0
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      if (Number.isNaN(selectTime)) {
        degree
      } else {
        degree = (360 / 60) * selectTime
      }
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentMinute.value = resultingValue
      selectMinute.value = selectTime
      minuteDegrees.value = degree
    } else if (selectFrame.value === 2) {
      let degree = 0
      let selectTime = selectSecond.value
      if (selectTime > 59) selectTime = 0
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      if (Number.isNaN(selectTime)) {
        degree
      } else {
        degree = (360 / 60) * selectTime
      }
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentSecond.value = resultingValue
      selectSecond.value = selectTime
      secondDegrees.value = degree
    }
  }
)

//------------------------------------------------------------------------------------------------------------
// ライフサイクル
//------------------------------------------------------------------------------------------------------------
onBeforeUnmount(() => clearInterval(timer))
//------------------------------------------------------------------------------------------------------------
// メソッド
//------------------------------------------------------------------------------------------------------------
// 現在の時刻を表示
const timer = setInterval(() => {
  nowTime.value = dayjs().format('hh:mm:ss')
}, 1000)

// モーダルの開閉
function onOpen(open: boolean) {
  modalSwitch.value.opened = open
}

// プロップスの値を変化
function formattedTime(value: string) {
  if (value === 'hh' || value === 'mm' || value === 'ss') {
    return 0
  } else {
    return parseInt(value)
  }
}

function setDegree(value: string) {
  if (value === 'hour') {
    return (360 / 12) * formattedTime(props.hour)
  } else if (value === 'minute') {
    return (360 / 60) * formattedTime(props.minute)
  } else if (value === 'second') {
    return (360 / 60) * formattedTime(props.second)
  }
}

// 数字が1桁の場合、先頭に0を付与
function formatTime(value: string) {
  return value.toString().padStart(2, '0')
}

// 数字の上限を監視
function normalizeTimeValue(currentValue: any, max: number, overflowValue: number) {
  if (currentValue > max) return overflowValue
  if (currentValue < 0) return max
  return currentValue
}

// 時計の文字盤に表示される数字をクリックして角度をセット
function moveClock(num: number) {
  emits('update:inputState', false)
  const selectTime = num
  const resultingValue = num < 10 ? '0' + num : num.toString()
  let degree: number

  if (!clockHand.value) return
  if (selectFrame.value === 0) {
    degree = (360 / 12) * selectTime
    clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
    currentHour.value = resultingValue
    selectHour.value = selectTime
    hourDegrees.value = degree
  } else if (selectFrame.value === 1) {
    degree = (360 / 60) * selectTime
    clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
    currentMinute.value = resultingValue
    selectMinute.value = selectTime
    minuteDegrees.value = degree
  } else if (selectFrame.value === 2) {
    degree = (360 / 60) * selectTime
    clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
    currentSecond.value = resultingValue
    selectSecond.value = selectTime
    secondDegrees.value = degree
  }
  emits('update:time', Number(currentHour.value), Number(currentMinute.value), Number(currentSecond.value))
}

function onMouseDown() {
  if (!clockRef.value) return
  clockRect.value = clockRef.value.getBoundingClientRect()
  centerX.value = clockRect.value.left + clockRect.value.width / 2
  centerY.value = clockRect.value.top + clockRect.value.height / 2

  window.addEventListener('mousemove', onMouseMove)
  window.addEventListener('mouseup', onMouseUp)
}

// 時計の短針をドラッグして時をセット
function onMouseMove(event: MouseEvent) {
  emits('update:inputState', false)
  mouseX.value = event.clientX
  mouseY.value = event.clientY

  dx.value = mouseX.value - centerX.value
  dy.value = mouseY.value - centerY.value
  radians.value = Math.atan2(dy.value, dx.value)

  let degreeValue
  if (clockHand.value) {
    if (selectFrame.value === 0) {
      degreeValue = hourDegrees
    } else if (selectFrame.value === 1) {
      degreeValue = minuteDegrees
    } else if (selectFrame.value === 2) {
      degreeValue = secondDegrees
    }

    if (degreeValue) {
      degreeValue.value = (radians.value * 180) / Math.PI + 90

      if (degreeValue.value < 0) {
        degreeValue.value += 360
      }

      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degreeValue.value - 90}deg)`
    }
  }

  if (selectFrame.value === 0) {
    const distance = Math.sqrt(dx.value * dx.value + dy.value * dy.value)
    const threshold = 90
    const isInnerCircle = distance < threshold
    if (!hourDegrees.value) return
    let calculatedHour = hourDegrees.value / 30
    const fractionalPart = calculatedHour % 1

    // 数字の真ん中で次の数字に切り変わるように設定
    if (fractionalPart >= 0.5) {
      if (calculatedHour >= 11 && calculatedHour < 12) {
        // 11時から0時、および23時から12時の間の例外処理
        calculatedHour = 0
        if (!clockHand.value) return
        if (degreeValue) {
          degreeValue.value = 0
          clockHand.value.style.transform = `translateY(-50%) rotateZ(${degreeValue.value - 90}deg)`
        }
      } else {
        calculatedHour = calculatedHour + 1
      }
    }

    // 内側の数字と外側の数字のどちらに文字色を当てるか判定
    if (isInnerCircle) {
      calculatedHour = calculatedHour + 12
    }

    currentHour.value = calculatedHour < 10 ? '0' + calculatedHour : calculatedHour.toString()
    selectHour.value = calculatedHour
  } else if (selectFrame.value === 1) {
    // 分は60なので、1時間あたり6°で計算
    if (!minuteDegrees.value) return
    let calculatedMinute = minuteDegrees.value / 6
    const fractionalPart = calculatedMinute % 1

    // 数字の真ん中で次の数字に切り変わるように設定
    if (fractionalPart >= 0.5) {
      if (calculatedMinute >= 59 && calculatedMinute < 60) {
        // 59分から0分の間の例外処理
        calculatedMinute = 0
        if (!clockHand.value) return
        if (degreeValue) {
          degreeValue.value = 0
          clockHand.value.style.transform = `translateY(-50%) rotateZ(${degreeValue.value - 90}deg)`
        }
      } else {
        calculatedMinute = calculatedMinute + 1
      }
    }

    currentMinute.value =
      calculatedMinute === 60 ? '00' : calculatedMinute < 10 ? '0' + calculatedMinute : calculatedMinute.toString()
    selectMinute.value = calculatedMinute
  } else if (selectFrame.value === 2) {
    // 秒は60なので、1時間あたり6°で計算
    if (!secondDegrees.value) return
    let calculatedSecound = secondDegrees.value / 6
    const fractionalPart = calculatedSecound % 1

    // 数字の真ん中で次の数字に切り変わるように設定
    if (fractionalPart >= 0.5) {
      if (calculatedSecound >= 59 && calculatedSecound < 60) {
        // 59秒から0秒の間の例外処理
        calculatedSecound = 0
        if (!clockHand.value) return
        if (degreeValue) {
          degreeValue.value = 0
          clockHand.value.style.transform = `translateY(-50%) rotateZ(${degreeValue.value - 90}deg)`
        }
      } else {
        calculatedSecound = calculatedSecound + 1
      }
    }

    currentSecond.value =
      calculatedSecound === 60 ? '00' : calculatedSecound < 10 ? '0' + calculatedSecound : calculatedSecound.toString()
    selectSecond.value = calculatedSecound
  }
}

function onMouseUp() {
  window.removeEventListener('mousemove', onMouseMove)
  window.removeEventListener('mouseup', onMouseUp)
}

function moveWheel(event: WheelEvent) {
  let degree: number
  let selectTime: number
  emits('update:inputState', false)
  if (!clockHand.value) return
  if (selectFrame.value === 0) {
    if (event.deltaY > 0) {
      selectTime = selectHour.value + 1
      if (selectTime > 23) selectTime = 0
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      degree = (360 / 12) * selectTime
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentHour.value = resultingValue
      selectHour.value = selectTime
      hourDegrees.value = degree
    } else {
      selectTime = selectHour.value - 1
      if (selectTime < 0) selectTime = 23
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      degree = (360 / 12) * selectTime
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentHour.value = resultingValue
      selectHour.value = selectTime
      hourDegrees.value = degree
    }
  } else if (selectFrame.value === 1) {
    if (event.deltaY > 0) {
      selectTime = selectMinute.value + 1
      if (selectTime > 59) selectTime = 0
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      degree = (360 / 60) * selectTime
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentMinute.value = resultingValue
      selectMinute.value = selectTime
      minuteDegrees.value = degree
    } else {
      selectTime = selectMinute.value - 1
      if (selectTime < 0) selectTime = 59
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      degree = (360 / 60) * selectTime
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentMinute.value = resultingValue
      selectMinute.value = selectTime
      minuteDegrees.value = degree
    }
  } else if (selectFrame.value === 2) {
    if (event.deltaY > 0) {
      selectTime = selectSecond.value + 1
      if (selectTime > 59) selectTime = 0
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      degree = (360 / 60) * selectTime
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentSecond.value = resultingValue
      selectSecond.value = selectTime
      secondDegrees.value = degree
    } else {
      selectTime = selectSecond.value - 1
      if (selectTime < 0) selectTime = 59
      const resultingValue = selectTime < 10 ? '0' + selectTime : selectTime.toString()
      degree = (360 / 60) * selectTime
      clockHand.value.style.transform = `translateY(-50%) rotateZ(${degree - 90}deg)`
      currentSecond.value = resultingValue
      selectSecond.value = selectTime
      secondDegrees.value = degree
    }
  }
}

// ダイアログで設定した時間をセット
function onSubmit(value: number) {
  if (value <= 0) return
  hour.value = formattedHour.value
  minute.value = formattedMinute.value
  second.value = formattedSecound.value
}

// フレームを変更
function changeFrame(value: string) {
  if (value === 'up') {
    if (selectFrame.value === 2) return
    selectFrame.value += 1
  } else if (value === 'down') {
    if (selectFrame.value === 0) return
    selectFrame.value -= 1
  }
}

// 時針の長さを変更
function selectHourWidth() {
  if (selectFrame.value === 0) {
    return {
      width: selectHour.value >= 12 ? '21.5%' : '37%',
    }
  } else if (selectFrame.value === 1 || selectFrame.value === 2) {
    return {
      width: '40%',
    }
  } else {
    return {}
  }
}

// フレームで時針の長さを変更
function changeDegree(frameNum: number) {
  let degrees

  if (frameNum === 0) {
    degrees = hourDegrees.value
  } else if (frameNum === 1) {
    degrees = minuteDegrees.value
  } else if (frameNum === 2) {
    degrees = secondDegrees.value
  }

  if (typeof degrees !== 'undefined') {
    return { transform: `translateY(-50%) rotate(${degrees - 90}deg)` }
  }

  return {}
}
// 分と秒の背景色を変更
function changeBackGround(i: number) {
  if ((selectFrame.value === 1 && i === selectMinute.value) || (selectFrame.value === 2 && i === selectSecond.value)) {
    return 'HighlightedPoint'
  }
  return {}
}

// フレームの番号から時間の変数を選択
function getSelectedValue(frameNum: number) {
  switch (frameNum) {
    case 0:
      return selectHour.value
    case 1:
      return selectMinute.value
    case 2:
      return selectSecond.value
    default:
      return undefined
  }
}

// 背景色を変更
function onColor(frameNum: number, value: number) {
  const selectedValue = getSelectedValue(frameNum)
  return [
    frameNum === 0 ? `AnalogNum${value}` : `Num${value}`,
    {
      BgChanged: selectedValue === value,
    },
  ]
}

// すべての値をリセットs
function resetDate() {
  const zeroStr = '00'
  const zero = 0
  hour.value = zeroStr
  minute.value = zeroStr
  second.value = zeroStr
  currentHour.value = zeroStr
  currentMinute.value = zeroStr
  currentSecond.value = zeroStr
  selectHour.value = zero
  selectMinute.value = zero
  selectSecond.value = zero
  hourDegrees.value = zero
  minuteDegrees.value = zero
  secondDegrees.value = zero
  selectFrame.value = zero
  hourDegrees.value = zero
  minuteDegrees.value = zero
  secondDegrees.value = zero
  radians.value = zero
  centerX.value = zero
  centerY.value = zero
  dx.value = zero
  dy.value = zero
  mouseX.value = zero
  mouseY.value = zero
}
</script>

<style scoped>
.DialClock {
  height: 270px;
  margin-top: 5px;
}

.AnalogClock {
  position: relative;
  width: 250px;
  margin: 0 auto;
}

.Header {
  display: flex;
  justify-content: center;
}

.Container {
  display: flex;
  justify-content: center;
}

.AnalogFrame {
  box-sizing: border-box;
  position: relative;
  width: 100%;
  border: 1px solid #444;
  border-radius: 50%;
}

.Buttons {
  display: flex;
}

.Button {
  margin: auto 0px;
  width: 25px;
  height: 25px;
  font-size: 15px;
  font-weight: bold;
  border-radius: 50%;
  color: rgb(61, 146, 174);
  box-shadow: 1px 1px 3px rgba(148, 148, 148, 0.24);
}

.HiddenButton {
  margin: auto 0px;
  width: 25px;
  height: 25px;
  visibility: hidden;
}

Button:hover {
  opacity: 0.8;
}

Button:active {
  -webkit-transform: translate(0, 1px);
  -moz-transform: translate(0, 1px);
  transform: translate(0, 1px);
  border-bottom: none;
}

.AnalogFrame::before {
  content: "";
  display: block;
  padding-top: 100%;
}

.AnalogHand {
  position: absolute;
  top: 50%;
  left: 50%;
  transform-origin: left;
  background-color: #333;
  height: 2px;
  z-index: 2;
}

.AnalogCenter {
  transform: translate(-50%, -50%);
  width: 4%;
  height: 4%;
  border: 4px solid #333;
  border-radius: 50%;
  background-color: #000;
}

.grayFont {
  color: gray;
}

.AnalogNum {
  position: absolute;
  font-size: 20px;
  transform: translate(-48.5%, -48.5%);
  text-align: center;
  z-index: 3;
  width: 35px;
  height: 35px;
  line-height: 35px;
  border-radius: 50%;
  cursor: pointer;
}

.AnalogNum0 {
  top: 8%;
  left: 50%;
}

.AnalogNum1 {
  top: 13.63%;
  left: 71%;
}

.AnalogNum2 {
  top: 29%;
  left: 86.37%;
}

.AnalogNum3 {
  top: 50%;
  left: 92%;
}

.AnalogNum4 {
  top: 71%;
  left: 86.37%;
}

.AnalogNum5 {
  top: 86.37%;
  left: 71%;
}

.AnalogNum6 {
  top: 92%;
  left: 50%;
}

.AnalogNum7 {
  top: 86.37%;
  left: 29%;
}

.AnalogNum8 {
  top: 71%;
  left: 13.63%;
}

.AnalogNum9 {
  top: 50%;
  left: 8%;
}

.AnalogNum10 {
  top: 29%;
  left: 13.63%;
}

.AnalogNum11 {
  top: 13.63%;
  left: 29%;
}

.AnalogNum12 {
  font-size: 15px;
  top: 22%;
  left: 50%;
}

.AnalogNum13 {
  font-size: 15px;
  top: 25.75%;
  left: 64%;
}

.AnalogNum14 {
  font-size: 15px;
  top: 36%;
  left: 74.25%;
}

.AnalogNum15 {
  font-size: 15px;
  top: 50%;
  left: 78%;
}

.AnalogNum16 {
  font-size: 15px;
  top: 64%;
  left: 74.25%;
}

.AnalogNum17 {
  font-size: 15px;
  top: 74.25%;
  left: 64%;
}

.AnalogNum18 {
  font-size: 15px;
  top: 78%;
  left: 50%;
}

.AnalogNum19 {
  font-size: 15px;
  top: 74.25%;
  left: 36%;
}

.AnalogNum20 {
  font-size: 15px;
  top: 64%;
  left: 25.75%;
}

.AnalogNum21 {
  font-size: 15px;
  top: 50%;
  left: 22%;
}

.AnalogNum22 {
  font-size: 15px;
  top: 36%;
  left: 25.75%;
}

.AnalogNum23 {
  font-size: 15px;
  top: 25.75%;
  left: 36%;
}

.Num0 {
  top: 7%;
  left: 50%;
}

.Num5 {
  top: 12.76%;
  left: 71.5%;
}

.Num10 {
  top: 28.5%;
  left: 87.24%;
}

.Num15 {
  top: 50%;
  left: 93%;
}

.Num20 {
  top: 71.5%;
  left: 87.24%;
}

.Num25 {
  top: 87.24%;
  left: 71.5%;
}

.Num30 {
  top: 93%;
  left: 50%;
}

.Num35 {
  top: 87.24%;
  left: 28.5%;
}

.Num40 {
  top: 71.5%;
  left: 12.76%;
}

.Num45 {
  top: 50%;
  left: 7%;
}

.Num50 {
  top: 28.5%;
  left: 12.76%;
}

.Num55 {
  top: 12.76%;
  left: 28.5%;
}

.BgChanged {
  background-color: var(--backColor);
}

.HighlightedPoint {
  background-color: var(--backColor);
}

.TimeNum {
  position: absolute;
  font-size: 12px;
  font-weight: bold;
  transform: translate(-50%, -48%);
  text-align: center;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  line-height: 24px;
  z-index: 3;
  cursor: pointer;
}

.PointContainer {
  position: absolute;
  top: 47%;
  left: 47%;
  width: 14px;
  height: 14px;
  line-height: 14px;
  border-radius: 50%;
  z-index: 2;
  cursor: pointer;
}

.Point {
  position: absolute;
  top: 0.5px;
  left: -1px;
}

.PickTime {
  display: flex;
  justify-content: center;
  font-size: 14px;
  border-bottom: 1px solid #000;
}

.Time {
  font-size: 20px;
  font-weight: bold;
  color: v-bind(useColor(primaryColor));
}

.PickTime > div,
.PickTime > span {
  line-height: 20px;
}
</style>
