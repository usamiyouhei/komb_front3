<template>
  <div class="Slider" :style="{ width: width }">
    <div :class="['SlideInputArea', showValueTip ? 'showValueTip' : '']">
      <input
        type="range"
        :min="min"
        :max="max"
        :step="type === SLIDER_TYPE.POINT ? step : 1"
        :value="rangePosition"
        class="SliderInput"
        @change="onChange"
        @input="onInput"
      />
      <div class="ValueLabelArea">
        <label v-if="showValueTip" class="ValueLabel" :style="{ left: `${rangePosition}%` }">{{ rangePosition }}</label>
      </div>
    </div>
    <div v-if="showMinMaxLabel" class="NumberArea">
      <span>{{ min }}</span>
      <span>{{ max }}</span>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch, onMounted } from 'vue'
import { SLIDER_TYPE } from '../../composables/constants'

//------------------------------------------------------------------------------------------------------------
// 引数
//------------------------------------------------------------------------------------------------------------
interface Props {
  type: string
  value: number
  min?: number
  max?: number
  step?: number
  showValueTip?: boolean
  showMinMaxLabel?: boolean
  width?: string
  height?: number
  color?: string
}
const props = withDefaults(defineProps<Props>(), {
  type: SLIDER_TYPE.SMOOTH,
  min: 0,
  max: 100,
  value: 50,
  step: 10,
  showValueTip: false,
  showMinMaxLabel: false,
  width: '100%',
  height: 18,
  color: '#ccc',
})

//------------------------------------------------------------------------------------------------------------
// 定数・変数（state）
//------------------------------------------------------------------------------------------------------------
const rangePosition = ref(50)

//------------------------------------------------------------------------------------------------------------
// ライフサイクル
//------------------------------------------------------------------------------------------------------------
onMounted(() => {
  rangePosition.value = props.value
})

//------------------------------------------------------------------------------------------------------------
//watch
//------------------------------------------------------------------------------------------------------------
watch(
  () => props.value,
  (value) => {
    rangePosition.value = value
  }
)

//------------------------------------------------------------------------------------------------------------
// エミット
//------------------------------------------------------------------------------------------------------------
const emits = defineEmits<{
  (e: 'update:value', value: number): void
}>()

function onChange(e: Event) {
  const target = e.target as HTMLInputElement // 型アサーション
  const value = +target.value
  emits('update:value', value)
}

function onInput(e: Event) {
  const target = e.target as HTMLInputElement // 型アサーション
  const value = +target.value
  emits('update:value', value)
}
</script>

<style scoped>
.Slider {
  width: 100%;
}
.Slider .SlideInputArea {
  width: 100%;
  height: 22px;
}
.Slider .SlideInputArea .SliderInput {
  -webkit-appearance: none;
  appearance: none;
  cursor: pointer;
  width: 100%;
  height: 2px;
  border-radius: 0;
  background: #d3d3d3;
  outline: none;
}
.Slider .SlideInputArea .SliderInput::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: #fff;
  border: 2px solid v-bind(color);
  border-radius: 50%;
  cursor: pointer;
}
.Slider .SlideInputArea .SliderInput::-moz-range-thumb {
  width: 20px;
  height: 20px;
  background: #333;
  border: 3px solid rgba(51, 51, 51, 0.3);
  border-radius: 50%;
  cursor: pointer;
}
.Slider .SlideInputArea .ValueLabelArea {
  width: calc(100% - 22px);
  position: relative;
}
.Slider .SlideInputArea .ValueLabelArea .ValueLabel {
  position: absolute;
  display: flex;
  width: 24px;
  height: 24px;
  justify-content: center;
  align-items: center;
  bottom: -34px;
  font-size: 10px;
  background: v-bind(color);
  mix-blend-mode: difference;
  border-radius: 50%;
}
.Slider .SlideInputArea .ValueLabelArea .ValueLabel:after {
  content: "";
  position: absolute;
  top: 0%;
  left: 50%;
  margin-left: -6px;
  margin-top: -10px;
  border: 6px solid transparent;
  border-bottom: 6px solid v-bind(color);
}
.Slider .SlideInputArea.showValueTip {
  margin-bottom: 10px;
}
.Slider .SlideInputArea.showValueTip::-webkit-slider-thumb::after {
  display: block;
  content: v-bind(rangePosition);
  width: 10px;
  height: 10px;
  background: #fff;
  position: absolute;
  bottom: 2px;
  text-align: center;
  font-size: 10px;
}
.Slider .NumberArea {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
}
</style>
