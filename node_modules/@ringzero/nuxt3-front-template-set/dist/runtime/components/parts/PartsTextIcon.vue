<template>
  <div class="Circle">{{ input }}</div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'
/**===================================================================================================================
   * 
   ===================================================================================================================**/
//------------------------------------------------------------------------------------------------------------
// 引数
//------------------------------------------------------------------------------------------------------------
interface Props {
  text: string
}
const props = withDefaults(defineProps<Props>(), {})

//------------------------------------------------------------------------------------------------------------
// 定数・変数（state）
//------------------------------------------------------------------------------------------------------------
const input = ref(getFirstCharacters(props.text).toUpperCase())
//------------------------------------------------------------------------------------------------------------
// ライフサイクル
//------------------------------------------------------------------------------------------------------------
//------------------------------------------------------------------------------------------------------------
//watch
//------------------------------------------------------------------------------------------------------------
watch(
  () => props.text,
  (value) => {
    input.value = getFirstCharacters(value).toUpperCase()
  }
)
//------------------------------------------------------------------------------------------------------------
//computed
//------------------------------------------------------------------------------------------------------------
/*
  const counter: Ref<number> = useState('counter', () => 500)
  
  // computedによりcounter変数の監視が行われる
  const doubleCount = computed(() => {
    return counter.value * 2
  })
  */
//------------------------------------------------------------------------------------------------------------
// エミット
//------------------------------------------------------------------------------------------------------------
/*
  const emits = defineEmits<{ (e: 'update:value', item: any): void }>()
  const input = ref(props.value)
  
  function onChange(value: any) {
    input.value = value
    emits('update:value', value)
  }
  */

//------------------------------------------------------------------------------------------------------------
// メソッド
//------------------------------------------------------------------------------------------------------------
function getFirstCharacters(str: string) {
  let count = 0
  let result = ''

  for (let i = 0; i < str.length; i++) {
    const char = str[i]
    // UTF-16 コードユニットを取得
    const code = char.charCodeAt(0)

    // 半角文字の場合
    if (
      (code >= 0x00 && code < 0x81) ||
      code === 0xf8f0 ||
      (code >= 0xff61 && code < 0xffa0) ||
      (code >= 0xf8f1 && code < 0xf8f4)
    ) {
      count += 1 // 半角文字は「1」をカウントに追加
    } else {
      count += 2 // それ以外（全角文字など）は「2」をカウントに追加
    }

    result += char

    if (count >= 2) {
      break
    }
  }

  return result
}
</script>

<style scoped>
.Circle {
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 12px;
  width: 27px;
  min-width: 27px;
  height: 27px;
  padding-top: 1.8px;
  line-height: 12px;
  margin-right: 10px;
  border-radius: 30px;
  border: 2px solid rgba(var(--r-color-reverse));
  background-color: rgba(var(--r-color-reverse), 0.2);
}
</style>
