<template>
  <div class="Accordion">
    <div class="AccordionHeader" :class="{ HeaderButton: auto }" @click="onOpen">
      <slot name="header" />
    </div>
    <div
      ref="AccordionContents"
      class="AccordionContents"
      :class="{ dummy: !initialize }"
      :style="{ height: isOpen || !initialize ? mHeight + 'px' : 0 }"
    >
      <slot name="contents" />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch, onMounted, type Ref } from 'vue'
/**===================================================================================================================
   * アコーディオン
   ===================================================================================================================**/
//------------------------------------------------------------------------------------------------------------
// 引数
//------------------------------------------------------------------------------------------------------------
interface Props {
  auto?: boolean
  opened?: boolean
  width?: number
  height?: number
}

const props = withDefaults(defineProps<Props>(), {
  auto: true,
})
//------------------------------------------------------------------------------------------------------------
// 定数・変数（state）
//------------------------------------------------------------------------------------------------------------
const initialize = ref(false)
const AccordionContents: Ref<HTMLDivElement | null> = ref(null)
const mHeight: Ref<number | undefined> = ref(props.height)
const isOpen = ref(props.opened)

//------------------------------------------------------------------------------------------------------------
// ライフサイクル
//------------------------------------------------------------------------------------------------------------
onMounted(() => {
  //window.addEventListener('resize', onGetPosition)
  if (AccordionContents.value && !props.height) {
    mHeight.value = AccordionContents.value.getBoundingClientRect().height
  }
  initialize.value = true
})

/*
  onBeforeMount(() => {
    //記憶した位置、サイズでの復帰を可能にする
  })


  onBeforeUnmount(() => {
    //window.removeEventListener('resize', onGetPosition)
  })
  */
//------------------------------------------------------------------------------------------------------------
//watch
//------------------------------------------------------------------------------------------------------------
watch(
  () => props.opened,
  (value) => {
    isOpen.value = value
  }
)
//------------------------------------------------------------------------------------------------------------
// エミット
//------------------------------------------------------------------------------------------------------------
/*
  const emits = defineEmits<{ (e: 'update:value', item: any): void }>()
  const input = ref(props.value)

  function onChange(value: any) {
    input.value = value
    emits('update:value', value)
  }
  */

//------------------------------------------------------------------------------------------------------------
// メソッド
//------------------------------------------------------------------------------------------------------------
function onOpen() {
  if (props.auto) {
    isOpen.value = !isOpen.value
  }
}
</script>

<style scoped>
.Accordion {
  position: relative;
}

.AccordionContents {
  position: relative;
  overflow: hidden;
  transition: height 0.3s ease-in-out;
}

.dummy {
  top: -10000px;
}

.HeaderButton {
  cursor: pointer;
}
</style>
