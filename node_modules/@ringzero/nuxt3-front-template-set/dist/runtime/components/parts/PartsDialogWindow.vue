<template>
  <ClientOnly>
    <teleport to="#dialog-area">
      <PartsModalWindow
        :name="name"
        :title="title"
        :switcher="switcher"
        :fixedSize="fixedSize"
        :reset="reset"
        :resize="false"
        :scroll="false"
        :fixed="true"
        :close="close"
        :modeless="modeless"
      >
        <template #title>
          <div class="title">{{ inputTitle }}</div>
        </template>
        <div class="Dialog">
          <div class="DialogInner">
            <slot>
              <div class="TextArea">
                <h2>{{ inputHeadline }}</h2>
                <div>
                  <p v-if="!Array.isArray(inputText)">
                    {{ inputText }}
                  </p>
                  <ul class="List" v-else-if="isList">
                    <li v-for="t in inputText">{{ t }}</li>
                  </ul>
                  <div v-else>
                    <p v-for="t in inputText">{{ t }}</p>
                  </div>
                </div>
              </div>
            </slot>
          </div>
          <slot name="action">
            <ButtonSet
              :currentButton="currentButton"
              @update:value="sendValue"
              :disabled="disabled"
              @update:close="isClose"
            />
          </slot>
        </div>
      </PartsModalWindow>
    </teleport>
  </ClientOnly>
</template>

<script setup lang="ts">
import { type FixedSize } from '../../components/common'
import { ref, watch, type Ref } from 'vue'
import { useDialogTypeNum } from '../../composables/useDialog'
import type { ModalSwitch } from '../../types'

interface Props {
  name?: string
  switcher: ModalSwitch
  buttons: string[]
  colors: string[]
  fixedSize?: FixedSize
  close?: boolean
  title?: string
  headline?: string
  text?: string | string[]
  reset?: boolean
  list?: boolean
  disabled?: boolean
  modeless?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  close: false,
  name: 'DialogWindow',
})

const emits = defineEmits<{
  (e: 'update:value', item: number): void
  (e: 'update:close', status: boolean): void
}>()
const modeless = ref(props.modeless)
const buttons = ref(props.buttons)
const colors = ref(props.colors)
const currentButton = ref(useDialogTypeNum(props.buttons, props.colors))
const inputTitle: Ref<string | undefined> = ref(props.title)
const inputHeadline: Ref<string | undefined> = ref(props.headline)
const inputText: Ref<string | string[] | undefined> = ref(props.text)
const isList = ref(props.list)

watch(
  () => props.modeless,
  (value) => {
    modeless.value = value
  }
)

watch(
  () => props.buttons,
  (button) => {
    buttons.value = button
    currentButton.value = useDialogTypeNum(buttons.value, colors.value)
  },
  { deep: true }
)

watch(
  () => props.colors,
  (color) => {
    colors.value = color
    currentButton.value = useDialogTypeNum(buttons.value, colors.value)
  },
  { deep: true }
)

watch(
  () => props.title,
  (title) => {
    inputTitle.value = title
  }
)

watch(
  () => props.headline,
  (headline) => {
    inputHeadline.value = headline
  }
)

watch(
  () => props.text,
  (text) => {
    inputText.value = text
  }
)

// エミット（クリックされたボタンの種類を保存）
function sendValue(item: number) {
  emits('update:value', item)
}

function isClose(status: boolean) {
  emits('update:close', status)
}
</script>

<style scoped>
.Dialog {
  position: relative;
  width: 100%;
  height: 100%;
}
.Dialog .DialogInner {
  position: relative;
  width: 100%;
  height: 100%;
  font-size: 12px;
  padding: 10px;
  margin: 0 auto;
}
.Dialog .DialogInner .TextArea {
  text-align: center;
}
.Dialog .DialogInner .TextArea .List {
  text-align: left;
  display: inline-block;
  list-style: disc;
  padding: 10px;
}

.title {
  width: 100%;
  text-align: center;
  font-weight: bold;
}

h2 {
  font-size: 14px;
}

p {
  font-size: 12px;
}
</style>
