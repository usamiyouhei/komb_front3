<template>
  <ButtonIcon
    class="ToggleButton"
    :class="{
      back: icon !== TOGGLE_TYPE.OTHER,
      circle: icon === TOGGLE_TYPE.RADIO || icon === TOGGLE_TYPE.CIRCLE,
      check: icon === TOGGLE_TYPE.CHECK || icon === TOGGLE_TYPE.SQUARE,
      other: icon === TOGGLE_TYPE.OTHER,
    }"
    :style="{ '--color': useGetThemeColor(color) }"
    :icon="item[0].icon"
    :icon-off="item[1].icon"
    :position="position"
    :size="24"
    :label="label"
    :color="actived ? item[0].color : item[1].color"
    :toggle="actived"
    :backcolor="icon === TOGGLE_TYPE.OTHER ? undefined : backcolor || useColor('background')"
    :light="icon === TOGGLE_TYPE.OTHER"
    :disabled="disabled"
    :hint="hint"
    narrow
    @click="onClick()"
  />
</template>

<script setup lang="ts">
import { onBeforeMount, ref, type Ref } from 'vue'
import { ICONS, POSITION, THEME_COLOR } from '../../composables/constants'
import { TOGGLE_TYPE, type ToggleProps } from '../common'
import { useColor, useGetThemeColor } from '../../composables/colors'
/**===================================================================================================================
   *
   ===================================================================================================================**/
//------------------------------------------------------------------------------------------------------------
// 引数
//------------------------------------------------------------------------------------------------------------
interface Props {
  icon?: string
  icons?: ToggleProps[]
  value: string | number | boolean
  actived: boolean
  position?: string
  label?: string
  color?: string
  backcolor?: string
  fit?: boolean
  hint?: string
  disabled?: boolean
}

// propsのデフォルト値設定
const props = withDefaults(defineProps<Props>(), {
  icon: 'radio',
  actived: false,
  position: POSITION.RIGHT,
  color: 'primary',
})

//------------------------------------------------------------------------------------------------------------
// 定数・変数（state）
//------------------------------------------------------------------------------------------------------------
//state
const item: Ref<ToggleProps[]> = ref([])
//------------------------------------------------------------------------------------------------------------
// ライフサイクル
//------------------------------------------------------------------------------------------------------------
onBeforeMount(() => {
  if (props.icons) {
    item.value = props.icons
  } else if (props.icon === TOGGLE_TYPE.RADIO) {
    item.value = [
      { icon: ICONS.RADIO_ON, color: props.color || THEME_COLOR.primary },
      { icon: ICONS.RADIO_OFF, color: props.color || THEME_COLOR.primary },
    ]
  } else if (props.icon === TOGGLE_TYPE.CHECK) {
    item.value = [
      { icon: ICONS.CHECK_ON, color: props.color || THEME_COLOR.primary },
      { icon: ICONS.CHECK_OFF, color: props.color || THEME_COLOR.primary },
    ]
  }
})

//------------------------------------------------------------------------------------------------------------
//watch
//------------------------------------------------------------------------------------------------------------
//------------------------------------------------------------------------------------------------------------
//computed
//------------------------------------------------------------------------------------------------------------
// computedによりcounter変数の監視が行われる

//------------------------------------------------------------------------------------------------------------
// エミット
//------------------------------------------------------------------------------------------------------------
const emits = defineEmits<{ (e: 'update:value', item: string | number | boolean): void }>()

//------------------------------------------------------------------------------------------------------------
// メソッド
//------------------------------------------------------------------------------------------------------------

function onClick() {
  if (!props.disabled) {
    emits('update:value', props.value)
  }
}
</script>

<style scoped>
.ToggleButton {
  position: relative;
  height: 30px;
  display: flex;
  align-items: center;
  overflow: hidden;
}

.back ::v-deep(.Back) {
  top: 10px;
  left: 10px;
  width: 16px;
  height: 16px;
  opacity: 0;
  transition: all 0.2s ease-in-out;
  box-shadow: 0px 0px 3px 4px var(--color);
}
.back ::v-deep(.Icon) {
  padding: 3px;
}
.back:hover ::v-deep(.Back) {
  box-shadow: 0px 0px 3px 4px var(--color);
  opacity: 0.5;
}
.back:active ::v-deep(.Back) {
  box-shadow: 0px 0px 3px 4px var(--color);
  opacity: 0.5;
}

.check ::v-deep(.Icon) {
  border-radius: 2px !important;
  padding: 3px;
}
.check ::v-deep(.Icon)::before {
  content: "";
  position: absolute;
  left: 10px;
  top: 10px;
  width: 16px;
  height: 16px;
  background-color: rgba(var(--r-color-background));
}

.circle ::v-deep(.Icon) {
  padding: 3px;
}
.circle ::v-deep(.Icon)::before {
  content: "";
  position: absolute;
  left: 11px;
  top: 11px;
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background-color: rgba(var(--r-color-background));
}

.other ::v-deep(.Back) {
  filter: blur(4px);
  top: 4px;
  left: 4px;
  width: 28px;
  height: 28px;
}
</style>
