<template>
  <div class="TabSet">
    <div
      v-for="(item, i) in tabItems"
      @click="onClick(item)"
      class="Tab"
      :class="{
        Active: input === item.value,
      }"
      :style="{
        backgroundColor: input === item.value ? getColor(activeBackColor) : getColor(backColor),
        color: input === item.value ? getColor(activeColor) : getColor(color || useColor('color')),
        marginRight: margin && items.length - 1 !== i ? margin : 0,
        borderRadius: roundAll ? roundAll : round ? `${round} ${round} 0 0` : undefined,
        padding: padding ? padding : undefined,
        fontSize: fontSize ? fontSize : undefined,
        whiteSpace: 'nowrap',
      }"
    >
      {{ item.text }}<span v-if="item.extraData" :style="item.extraData.style">{{ item.extraData.text }}</span>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'
import { useGetThemeColor } from '../../composables/colors'
import type { TabProps } from '../../components/common'
import { useColor } from '../../composables/colors'

// props
interface Props {
  items?: TabProps[]
  value: string | number
  backColor?: string
  color?: string
  activeColor?: string
  activeBackColor?: string
  margin?: string
  padding?: string
  round?: string
  roundAll?: string
  fontSize?: string
}

// propsのデフォルト値設定
const props = withDefaults(defineProps<Props>(), {
  items: () => [
    { text: '1', value: 'test' },
    { text: '2', value: 'admin' },
  ],
  value: 'test',
  activeColor: '#fff',
  activeBackColor: '#666',
  backColor: 'transparent',
})

const tabItems = ref(props.items)
//------------------------------------------------------------------------------------------------------------
//watch
//------------------------------------------------------------------------------------------------------------
watch(
  () => props.value,
  (value) => {
    input.value = value
    // console.log('たぶ', value)
  }
)
watch(
  () => props.items,
  (value) => {
    tabItems.value = value
  },
  { deep: true }
)

const emits = defineEmits<{ (e: 'update:value', item: TabProps): void }>()

//state
const input: any = ref(props.value)

const onClick = (item: TabProps) => {
  input.value = item.value
  emits('update:value', item)
}

function getColor(color: string) {
  return useGetThemeColor(color)
}
</script>

<style scoped>
.TabSet {
  position: relative;
  display: flex;
}
.TabSet .Tab {
  font-size: 12px;
  font-weight: bold;
  padding: 6px 20px 4px;
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
  opacity: 0.4;
  transition: opacity 0.2s ease;
  cursor: pointer;
}
.TabSet .Tab.Active {
  opacity: 1;
}
.TabSet .Tab.Active:hover {
  opacity: 1;
}
.TabSet .Tab:hover {
  opacity: 0.9;
}
</style>
