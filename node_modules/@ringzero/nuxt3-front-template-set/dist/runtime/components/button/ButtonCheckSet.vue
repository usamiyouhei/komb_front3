<template>
  <div class="ButtonCheckSet" :class="{ inline: inline }">
    <template v-if="items && inputItems && inputItems.length">
      <ButtonToggle
        v-for="(item, i) in inputItems"
        class="CheckButton mr-2"
        icon="check"
        :value="item.value"
        :color="color"
        :actived="item.checked"
        :disabled="checkedItemDisabled ? items[i].checked : disabled"
        :label="item.text"
        @update:value="onChange(item)"
      />
      <div v-if="all" class="smallButton primary mr-2" @click="onChangeAll(true)">全選択</div>
      <div v-if="all" class="smallButton secondary" @click="onChangeAll(false)">全解除</div>
    </template>
    <template v-else>
      <div class="CheckButton noData">選択候補がありません</div>
    </template>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted, watch } from 'vue'
/**===================================================================================================================
   * チェックボックスセット
   ===================================================================================================================**/
import { type CheckBoxSetProps } from '../../components/common'

//------------------------------------------------------------------------------------------------------------
// 引数
//------------------------------------------------------------------------------------------------------------
interface Props {
  items?: CheckBoxSetProps[]
  inline?: boolean
  color?: string
  disabled?: boolean
  all?: boolean
  checkedItemDisabled?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  inline: false,
})

//------------------------------------------------------------------------------------------------------------
// 定数・変数（state）
//------------------------------------------------------------------------------------------------------------
const inputItems = ref(JSON.parse(JSON.stringify(props.items)))
const emits = defineEmits<{ (e: 'update:value', item: CheckBoxSetProps[]): void }>()

//------------------------------------------------------------------------------------------------------------
// ライフサイクル
//------------------------------------------------------------------------------------------------------------

onMounted(() => {
  //window.addEventListener('resize', onGetPosition)
})

//------------------------------------------------------------------------------------------------------------
//watch
//------------------------------------------------------------------------------------------------------------
watch(
  () => props.items,
  (value) => {
    inputItems.value = JSON.parse(JSON.stringify(props.items))
  }
)

//------------------------------------------------------------------------------------------------------------
//computed
//------------------------------------------------------------------------------------------------------------
//------------------------------------------------------------------------------------------------------------
// エミット
//------------------------------------------------------------------------------------------------------------
//------------------------------------------------------------------------------------------------------------
// メソッド
//------------------------------------------------------------------------------------------------------------

function onChangeAll(value: boolean) {
  if (inputItems.value) {
    inputItems.value.forEach((item: CheckBoxSetProps) => {
      item.checked = value
    })
    emits('update:value', inputItems.value)
  }
}

function onChange(item: CheckBoxSetProps) {
  item.checked = !item.checked
  // console.log(value)
  /*
    input.value[index].checked = !input.value[index].checked
    const values: (String | number | undefined)[] = []
    input.value.forEach((item, i) => {
      values.push(item.checked ? item.value : undefined)
    })
    values.join(',')
    */
  if (inputItems.value) {
    emits('update:value', inputItems.value)
  }
}
</script>

<style scoped>
.ButtonCheckSet {
  position: relative;
}
.ButtonCheckSet .CheckButton {
  position: relative;
  height: 30px;
  display: flex;
  align-items: center;
  overflow-y: hidden;
}

.inline {
  display: flex;
  flex-wrap: wrap;
}

::v-deep(.v-radio) {
  margin-right: 12px;
}

::v-deep(.v-label) {
  padding-top: 3px;
  font-size: 14px;
}

::v-deep(.v-icon--size-default) {
  font-size: 18px;
}

::v-deep(.v-selection-control--density-compact) {
  --v-selection-control-size: 26px;
}

.noData {
  font-size: 14px;
  color: rgba(var(--r-color-disabled));
}

.secondary {
  background-color: rgb(var(--r-color-secondary));
  color: rgb(var(--r-color-reverse));
}

.secondary:hover {
  background-color: rgba(var(--r-color-secondary), 0.6);
}
</style>
