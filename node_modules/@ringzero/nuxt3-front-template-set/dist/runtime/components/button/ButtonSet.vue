<template>
  <div class="ButtonSet">
    <div class="Set1">
      <ButtonSimple
        v-for="(item, i) in buttonLabels"
        class="DialogButton"
        color="#fff"
        :key="i"
        :width="100"
        :text="item"
        :disabled="checkDisabled(i)"
        :backcolor="buttonColors[i]"
        @click="onClick(i)"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'
interface Props {
  disabled?: boolean
  currentButton: {
    buttons: string[]
    colors: string[]
  }
}

const props = withDefaults(defineProps<Props>(), {})

//------------------------------------------------------------------------------------------------------------
//computed
//------------------------------------------------------------------------------------------------------------

// computedによりcounter変数の監視が行われる
function checkDisabled(no: number) {
  let result = false
  if (buttonLabels.value.length === 1) {
    result = false
  } else if (buttonLabels.value.length === 2 && no === 1) {
    result = props.disabled
  } else if (buttonLabels.value.length === 3 && no === 2) {
    result = props.disabled
  }
  return result
}

const emits = defineEmits<{
  (e: 'update:value', item: number): void
  (e: 'update:close', status: boolean): void
}>()

const buttonLabels = ref(props.currentButton.buttons)
const buttonColors = ref(props.currentButton.colors)

watch(
  () => props.currentButton,
  (value) => {
    buttonLabels.value = value.buttons
    buttonColors.value = value.colors
  },
  { deep: true }
)

const onClick = (value: number) => {
  if (buttonLabels.value.length === 1) {
    emits('update:value', value + 1)
  } else if (buttonLabels.value.length === 2) {
    if (value === 0) {
      emits('update:value', value - 1)
    } else {
      emits('update:value', value)
    }
  } else if (buttonLabels.value.length === 3) {
    emits('update:value', value - 1)
  }
  emits('update:close', false)
}
</script>

<style scoped>
.ButtonSet {
  position: absolute;
  width: 100%;
  bottom: 14px;
  display: flex;
  justify-content: center;
}
.ButtonSet .Set1 {
  display: flex;
  justify-content: center;
}
.ButtonSet .Set1 .DialogButton:not(:last-child) {
  margin-right: 20px;
}
</style>
